
<div class="cli-card fit-card">
  <div class="cli-card-body">
    <div class="cli-title c-male">Mantenimiento iniciativa</div>
    <div>
      <!-- BUSCADOR POR FILTRO -->
      <div class="card mt-5" style="border-radius: 2px; font-weight: 600">
        <div class="card-body">
          <form class="row g-3" [formGroup]="filtroForm">
            <div class="col-sm-2 cli-form-element">
              <label class="form-label">Nombre de Iniciativa</label>
              <input
                type="text"
                class="form-control"
                formControlName="nombre"
              />
            </div>
            <div class="col-sm-2 cli-form-element">
              <label class="form-label">Código de Iniciativa</label>
              <input
                type="text"
                class="form-control"
                formControlName="codigo"
              />
            </div>
            <div class="col-sm-3 cli-form-element">
              <label class="form-label">Estado</label>
              <select
                class="form-select"
                formControlName="estado"
              >
                <option [value]="0" disabled>-Seleccione-</option>
                <option [value]="estado.idEstado" *ngFor="let estado of listEstados">
                  {{ estado.cNombre }}
                </option>
              </select>
            </div>

            <div class="col-sm-3 cli-form-element">
              <label class="form-label">Gerencia Beneficiaria</label>
              <select
                class="form-select"
                formControlName="gerencia_benef"
              >
                <option [value]="0" disabled>-Seleccione-</option>
                <option [value]="gerenc.id" *ngFor="let gerenc of listGerencia">
                  {{ gerenc.nombre }}
                </option>
              </select>
            </div>

            <div class="col-sm-2 cli-form-element">
              <label class="form-label">Naturaleza del Benef.</label>
                <select
                  class="form-select"
                formControlName="naturaleza"
                >
                  <option [value]="0" disabled>--Seleccione--</option>
                  <option [value]="nat.id" *ngFor="let nat of naturaleza">
                    {{ nat.nombre }}
                  </option>
                </select>
            </div>

            <div class="col-sm-2 cli-form-elesksment">
              <div class="form-group">
                  <label>Fecha creación <span class="date-rango">(desde)</span></label>
                  <input type="date"
                  class="form-control"
                  formControlName="fechaCreaInicio">
              </div>
            </div>

            <div class="col-sm-2 cli-form-elesksment">
              <div class="form-group">
                  <label>Fecha creación <span class="date-rango">(hasta)</span></label>
                  <input type="date"
                  class="form-control"
                  formControlName="fechaCreaFin">
              </div>
            </div>

            <div class="flex-1"></div>

            <div class="cli-form-buttons">
              <button
                type="submit"
                class="cli-btn btn-grey"
                style="border-radius: 2px; padding: 0.225rem 0.75rem"
                (click)="limpiarFiltro()"
                ><mat-icon class="icon-18">rotate_left</mat-icon>
                Limpiar
              </button>

              <button
                type="button"
                class="cli-btn btn-blue-light"
                style="border-radius: 2px; padding: 0.225rem 0.75rem"
                (click)="buscarRegistro()"
                ><mat-icon class="icon-18">search</mat-icon>
                Buscar
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- BOTON MODAL PARA CREAR REGISTRO -->
      <div style="display: flex" class="mt-5">
        <button class="cli-btn btn-magenta mb-2"
                type="button"
                (click)="crearIniciativa()"
        ><mat-icon class="icon-18">add</mat-icon>Crear Iniciativa
        </button>
        <div class="flex-1"></div>
        <h3 class="card-subtitlte" style="color: #3b4ef6">
          Total : <span style="color: #adb0b2; font-size: 20px; font-weight: 500">
            {{ registros.length}} registros</span
          >
        </h3>
      </div>

      <!-- TABLA DE REGISTROS -->
      <div style="overflow: auto; min-height: 300px">
        <table class="cli-table stripedtable underlinedtable">
          <thead>
            <tr class="bgc-blue c-white">
              <th>Acción</th>
              <th>ID</th>
              <th>Nombre de Iniciativa</th>
              <th>Código de Iniciativa</th>
              <th>Estado</th>
              <th>PO del Proyecto</th>
              <th>Responsable</th>
              <th>Gerencia Beneficiaria</th>
              <th>Naturaleza</th>
              <th>Fecha creación</th>
            </tr>
          </thead>

          <tbody>
            <tr
              *ngFor="
                let registro of registros | paginate : { itemsPerPage: pageSize, currentPage: page, totalItems: totalIniciativa }">
              <td>
                <div class="cli-table-actions">
                  <button
                    matTooltip="Editar"
                    class="icon-btn btn-trans c-blue"
                    (click)="editarIniciativa(registro.idIniciativa)"
                   ><mat-icon class="icon-18">edit</mat-icon>
                 </button>
                  <button
                    matTooltip="Eliminar"
                    class="icon-btn btn-trans c-fucsia"
                    (click)="eliminarIniciativa(registro.idIniciativa)"
                  ><mat-icon class="icon-18">delete_forever</mat-icon>
                  </button>
                </div>
              </td>
              <td>{{ registro.idIniciativa }}</td>
              <td style="width: 135px; height: 68px;">{{ registro.nombre | uppercase }}</td>
              <td style="width: 135px; height: 68px;">{{ registro.codigo | uppercase }}</td>
              <td>{{ registro.estado }}</td>
              <td>{{ registro.po_proyecto }}</td>
              <td>{{ registro.responsable }}</td>
              <td>{{ registro.gerencia_beneficiaria }}</td>
              <td>{{ registro.naturaleza }}</td>
              <td>{{ registro.fecha_creacion }}</td>
            </tr>
          </tbody>
        </table>

        <div class="cli-loader" *ngIf="loadingItem">
          <mat-spinner style="margin-right: 20px" diameter="20"></mat-spinner>
          cargando...
        </div>

        <div *ngIf="!loadingItem && registros.length == 0" class="cli-loader mt-5" style="color: red">
          No hay registros para mostrar
        </div>
      </div>
    </div>

    <div class="card-footer pb-0 pt-3">
      <pagination-controls
        previousLabel="Anterior"
        nextLabel="Siguiente"
        [responsive]="false"
        (pageChange)="cambiarPagina($event)"
      >
      </pagination-controls>
    </div>
  </div>
</div>

